{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { useEffect, useState } from \"react\";\nimport SockJs from \"sockjs-client\";\nimport Stomp from \"stompjs\";\nimport IP_ADDRESS from \"./Const\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar stompClient = null;\nvar ChatScreen = function ChatScreen(_ref, navigation) {\n  var route = _ref.route;\n  var _route$params = route.params,\n    friendName = _route$params.friendName,\n    friendId = _route$params.friendId,\n    memberId = _route$params.memberId,\n    chatRoomId = _route$params.chatRoomId;\n  var data = [{\n    id: 1,\n    fromId: 1,\n    content: \"hello!!\"\n  }, {\n    id: 2,\n    fromId: 2,\n    content: \"hello my friend!!\"\n  }, {\n    id: 3,\n    fromId: 2,\n    content: \"What are you doing?\"\n  }, {\n    id: 4,\n    fromId: 1,\n    content: \"Shut up\"\n  }];\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    text = _useState2[0],\n    onChangeText = _useState2[1];\n  var _useState3 = useState(data.length),\n    _useState4 = _slicedToArray(_useState3, 2),\n    lastId = _useState4[0],\n    setLastId = _useState4[1];\n  var connect = function connect(memberData) {\n    var sock = new SockJs(`http://${IP_ADDRESS}:8080/sloppy-gate`);\n    stompClient = Stomp.over(sock);\n    stompClient.connect({}, function (frame) {\n      console.log(chatRoomId);\n      stompClient.subscribe(\"/chat_room/\" + chatRoomId, function (imessage) {\n        var message = imessage;\n        var messageData = JSON.parse(imessage.body);\n        addElement(messageData);\n      });\n    });\n  };\n  var addElement = function addElement(messageData) {\n    var id = data.length + 1;\n    var fromId = messageData.fromId;\n    var content = messageData.content;\n    console.log(\"id = \" + id);\n    console.log(\"fromId = \" + fromId);\n    console.log(\"content = \" + content);\n    data.push({\n      id: id,\n      fromId: fromId,\n      content: content\n    });\n    setLastId(id);\n    console.log(lastId);\n  };\n  useEffect(function () {\n    connect(memberId);\n  }, []);\n  var Content = function Content(_ref2) {\n    var fromId = _ref2.fromId,\n      content = _ref2.content;\n    return _jsx(View, {\n      style: styles.message_container,\n      children: fromId === memberId ? _jsxs(View, {\n        style: styles.my_message_box,\n        children: [_jsx(Text, {\n          style: styles.name,\n          children: \"me\"\n        }), _jsx(View, {\n          style: styles.content_box,\n          children: _jsx(Text, {\n            style: styles.content,\n            children: content\n          })\n        })]\n      }) : _jsxs(View, {\n        style: styles.other_message_box,\n        children: [_jsx(Text, {\n          style: styles.name,\n          children: friendName\n        }), _jsx(View, {\n          style: styles.content_box,\n          children: _jsx(Text, {\n            style: styles.content,\n            children: content\n          })\n        })]\n      })\n    });\n  };\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(View, {\n      style: styles.chat_container,\n      children: _jsx(FlatList, {\n        data: data,\n        renderItem: function renderItem(_ref3) {\n          var item = _ref3.item;\n          return _jsx(Text, {\n            children: item.content\n          });\n        },\n        keyExtractor: function keyExtractor(item) {\n          return item.id;\n        },\n        extraData: lastId\n      })\n    }), _jsxs(View, {\n      style: styles.input_container,\n      children: [_jsx(View, {\n        style: styles.input_box,\n        children: _jsx(TextInput, {\n          value: text,\n          onChangeText: onChangeText,\n          style: styles.t_input\n        })\n      }), _jsx(View, {\n        style: styles.button,\n        children: _jsx(Button, {\n          title: \"send\",\n          onPress: function onPress() {\n            stompClient.send(\"/ws/private\", {}, JSON.stringify({\n              fromId: memberId,\n              toId: friendId,\n              content: text,\n              chatRoomId: chatRoomId\n            }));\n            onChangeText(\"\");\n          }\n        })\n      })]\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: \"center\"\n  },\n  chat_container: {\n    flex: 7\n  },\n  input_container: {\n    flex: 1,\n    borderWidth: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\"\n  },\n  input_box: {\n    flex: 4,\n    justifyContent: \"center\"\n  },\n  button: {\n    flex: 1,\n    marginHorizontal: 4\n  },\n  t_input: {\n    borderWidth: 1,\n    borderRadius: 10,\n    height: 35,\n    marginHorizontal: 4\n  },\n  my_message_box: {\n    margin: 4,\n    justifyContent: \"center\",\n    alignItems: \"flex-end\",\n    padding: 10\n  },\n  other_message_box: {\n    margin: 4,\n    borderRadius: 10,\n    justifyContent: \"center\",\n    alignItems: \"flex-start\",\n    padding: 10\n  },\n  message_container: {\n    margin: 3\n  },\n  name: {\n    fontSize: 12\n  },\n  content: {\n    fontSize: 20\n  },\n  content_box: {\n    borderWidth: 1,\n    margin: 10,\n    borderRadius: 15,\n    minHeight: 20,\n    padding: 10,\n    maxWidth: 200\n  }\n});\nexport default ChatScreen;","map":{"version":3,"names":["useEffect","useState","SockJs","Stomp","IP_ADDRESS","jsx","_jsx","jsxs","_jsxs","stompClient","ChatScreen","_ref","navigation","route","_route$params","params","friendName","friendId","memberId","chatRoomId","data","id","fromId","content","_useState","_useState2","_slicedToArray","text","onChangeText","_useState3","length","_useState4","lastId","setLastId","connect","memberData","sock","over","frame","console","log","subscribe","imessage","message","messageData","JSON","parse","body","addElement","push","Content","_ref2","View","style","styles","message_container","children","my_message_box","Text","name","content_box","other_message_box","container","chat_container","FlatList","renderItem","_ref3","item","keyExtractor","extraData","input_container","input_box","TextInput","value","t_input","button","Button","title","onPress","send","stringify","toId","StyleSheet","create","flex","justifyContent","borderWidth","flexDirection","alignItems","marginHorizontal","borderRadius","height","margin","padding","fontSize","minHeight","maxWidth"],"sources":["/Users/jeonjun-wan/Documents/sloppyTalk/src/main/frontend/ChatScreen.js"],"sourcesContent":["import {Button, FlatList, StyleSheet, Text, TextInput, View} from \"react-native\";\nimport {useEffect, useState} from \"react\";\nimport SockJs from \"sockjs-client\"\nimport Stomp from \"stompjs\"\nimport IP_ADDRESS from \"./Const\";\n\nvar stompClient = null;\n\n\nconst ChatScreen = ({route},navigation) =>{\n    const {friendName,friendId,memberId,chatRoomId} = route.params;\n    let data = [\n        {id : 1, fromId : 1, content : \"hello!!\"},\n        {id : 2, fromId : 2, content : \"hello my friend!!\"},\n        {id : 3, fromId : 2, content : \"What are you doing?\"},\n        {id : 4, fromId : 1, content : \"Shut up\"},\n    ];\n\n    const [text, onChangeText] = useState(\"\");\n    const [lastId, setLastId] = useState(data.length);\n\n    const connect = (memberData) => {\n        const sock = new SockJs(`http://${IP_ADDRESS}:8080/sloppy-gate`);\n        stompClient = Stomp.over(sock);\n        stompClient.connect({},\n            frame => {\n\n                console.log(chatRoomId)\n\n                stompClient.subscribe(\n                    \"/chat_room/\" + chatRoomId,\n                    (imessage) => {\n                        const message = imessage;\n                        const messageData = JSON.parse(imessage.body);\n                        addElement(messageData);\n\n\n\n                    }\n                )\n            })\n    }\n\n    const addElement = (messageData) =>{\n        let id = data.length  + 1;\n        const fromId = messageData.fromId;\n        const content = messageData.content;\n        console.log(\"id = \" + id);\n        console.log(\"fromId = \" + fromId);\n        console.log(\"content = \" + content)\n\n        data.push(\n            {id: id, fromId: fromId,content: content}\n        )\n\n        setLastId(id);\n\n        console.log(lastId);\n\n\n    }\n\n    useEffect(() => {\n        connect(memberId);\n    },[])\n    const Content = ({fromId,content}) => (\n        <View style={styles.message_container}>\n\n            {fromId === memberId ?\n                <View style={styles.my_message_box}>\n                    <Text style={styles.name} >me</Text>\n                    <View style={styles.content_box}>\n                        <Text style={styles.content}>{content}</Text>\n                    </View>\n                </View>\n                :\n                <View style={styles.other_message_box}>\n                    <Text style={styles.name}>{friendName}</Text>\n                    <View style={styles.content_box}>\n                        <Text style={styles.content}>{content}</Text>\n                    </View>\n\n                </View>\n            }\n        </View>\n\n    )\n\n    return (\n        <View style={styles.container}>\n            <View style={styles.chat_container}>\n                <FlatList\n                    data={data}\n                    // renderItem={({item}) => <Content fromId={item.fromId} content={item.content}/>}\n                    renderItem={({item}) => <Text>{item.content}</Text>}\n                    keyExtractor={item => item.id}\n                    extraData={lastId}\n                />\n            </View>\n\n\n            <View style={styles.input_container}>\n                <View  style={styles.input_box}>\n                    <TextInput value={text} onChangeText={onChangeText} style={styles.t_input} />\n                </View>\n               <View style={styles.button}>\n                   <Button title=\"send\" onPress={() => {\n\n                        stompClient.send(\"/ws/private\",{}, JSON.stringify({\n                            fromId : memberId,\n                            toId : friendId,\n                            content : text,\n                            chatRoomId : chatRoomId\n                        })\n                        )\n\n                       onChangeText(\"\");\n                   }}/>\n               </View>\n\n            </View>\n    </View>\n)\n\n\n}\n\nconst styles = StyleSheet.create({\n    container : {\n        flex : 1,\n        justifyContent : \"center\"\n    },\n    chat_container : {\n        flex:7,\n\n    },\n    input_container:{\n        flex:1,\n        borderWidth:1,\n        flexDirection : \"row\",\n        alignItems:\"center\",\n\n\n    },\n    input_box : {\n        flex : 4,\n        justifyContent:\"center\",\n\n\n    },\n    button : {\n        flex : 1,\n        marginHorizontal:4,\n\n    },\n    t_input : {\n        borderWidth : 1,\n        borderRadius : 10,\n        height:35,\n        marginHorizontal:4,\n\n    },\n    my_message_box:{\n        margin : 4,\n        justifyContent:\"center\",\n        alignItems:\"flex-end\",\n        padding:10\n    },\n    other_message_box:{\n        margin : 4,\n        borderRadius :10,\n        justifyContent:\"center\",\n        alignItems:\"flex-start\",\n        padding:10\n    },\n    message_container:{\n        margin:3\n    },\n    name : {\n        fontSize:12\n    },\n    content:{\n        fontSize:20\n    },\n    content_box : {\n        borderWidth:1,\n        margin :10,\n        borderRadius:15,\n        minHeight:20,\n        padding:10,\n        maxWidth:200\n    }\n})\n\nexport default ChatScreen;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}